<div class="projects-container">
  <!-- Header -->
  <div class="projects-header">
    <div class="header-left">
      <h1 class="page-title">Projects</h1>
      <p class="page-subtitle">Manage and track your team's projects</p>
    </div>
    <div class="header-right">
      <button mat-raised-button color="primary" (click)="createNewProject()">
        <mat-icon>add</mat-icon>
        Create Project
      </button>
    </div>
  </div>

  <!-- Filters and Views -->
  <div class="projects-controls">
    <div class="controls-left">
      <mat-button-toggle-group [(value)]="currentView" (change)="onViewChange($event)">
        <mat-button-toggle value="grid">Grid View</mat-button-toggle>
        <mat-button-toggle value="list">List View</mat-button-toggle>
        <mat-button-toggle value="timeline">Timeline</mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div class="controls-right">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Filter by</mat-label>
        <mat-select [(value)]="selectedFilter" (selectionChange)="onFilterChange($event)">
          <mat-option value="all">All Projects</mat-option>
          <mat-option value="active">Active</mat-option>
          <mat-option value="inactive">Inactive</mat-option>
          <mat-option value="my-projects">My Projects</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-icon-button (click)="refreshProjects()">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Grid View -->
  <div class="grid-view" *ngIf="currentView === 'grid'">
    <div class="projects-grid">
      <div class="project-card" *ngFor="let project of filteredProjects" (click)="openProjectDetail(project)">
        <div class="project-header">
          <div class="project-icon">
            <mat-icon>{{ project.icon }}</mat-icon>
          </div>
          <div class="project-status" [class]="'status-' + project.status">
            {{ project.status }}
          </div>
        </div>
        <div class="project-content">
          <h3 class="project-title">{{ project.name }}</h3>
          <p class="project-description">{{ project.description }}</p>
          <!-- meta removed per request -->
          <div class="project-team">
            <div class="team-avatars">
              <div class="team-avatar" *ngFor="let member of project.team.slice(0, 3)">
                <span>{{ member.name.charAt(0) }}</span>
              </div>
              <div class="more-members" *ngIf="project.team.length > 3">
                +{{ project.team.length - 3 }}
              </div>
            </div>
            <span class="team-count">{{ project.team.length }} members</span>
          </div>
        </div>
        <div class="project-actions">
          <button mat-icon-button (click)="editProject(project, $event)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteProject(project, $event)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="list-view" *ngIf="currentView === 'list'">
    <div class="list-header">
      <div class="list-column">Project</div>
      <div class="list-column">Status</div>
      <div class="list-column">Progress</div>
      <div class="list-column">Team</div>
      <div class="list-column">Due Date</div>
      <div class="list-column">Actions</div>
    </div>
    <div class="list-content">
      <div class="list-row" *ngFor="let project of filteredProjects" (click)="openProjectDetail(project)">
        <div class="list-cell project-cell">
          <div class="project-info">
            <div class="project-icon-small">
              <mat-icon>{{ project.icon }}</mat-icon>
            </div>
            <div class="project-details">
              <h4 class="project-title">{{ project.name }}</h4>
              <p class="project-description">{{ project.description }}</p>
            </div>
          </div>
        </div>
        <div class="list-cell status-cell">
          <span class="status-badge" [class]="'status-' + project.status">{{ project.status }}</span>
        </div>
        <!-- progress removed -->
        <div class="list-cell team-cell">
          <div class="team-avatars-small">
            <div class="team-avatar-small" *ngFor="let member of project.team.slice(0, 2)">
              <span>{{ member.name.charAt(0) }}</span>
            </div>
            <span class="more-members-small" *ngIf="project.team.length > 2">+{{ project.team.length - 2 }}</span>
          </div>
        </div>
        <!-- due date removed -->
        <div class="list-cell actions-cell">
          <button mat-icon-button (click)="editProject(project, $event)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteProject(project, $event)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeline View -->
  <div class="timeline-view" *ngIf="currentView === 'timeline'">
    <div class="timeline-container">
      <div class="timeline-item" *ngFor="let project of filteredProjects">
        <div class="timeline-marker" [class]="'status-' + project.status">
          <mat-icon>{{ project.icon }}</mat-icon>
        </div>
        <div class="timeline-content">
          <div class="timeline-header">
            <h3 class="project-title">{{ project.name }}</h3>
            <span class="project-status" [class]="'status-' + project.status">{{ project.status }}</span>
          </div>
          <p class="project-description">{{ project.description }}</p>
          <!-- timeline meta removed -->
        </div>
      </div>
    </div>
  </div>

  <!-- Project Detail Modal -->
  <div class="project-detail-overlay" *ngIf="selectedProject" (click)="closeProjectDetail()">
    <div class="project-detail-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="project-header-info">
          <div class="project-icon-large">
            <mat-icon>{{ selectedProject.icon }}</mat-icon>
          </div>
        </div>
        <button mat-icon-button (click)="closeProjectDetail()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="modal-content">
        <div class="project-detail-section">
          <h3>Project Details</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Title:</label>
              <input matInput type="text" class="styled-input" [(ngModel)]="selectedProject.name" (ngModelChange)="updateProject()" placeholder="Project title">
            </div>
            <div class="detail-item">
              <label>Status:</label>
              <mat-select [(value)]="selectedProject.status" (selectionChange)="updateProject()">
                <mat-option value="active">Active</mat-option>
                <mat-option value="inactive">Inactive</mat-option>
              </mat-select>
            </div>
            <div class="detail-item detail-item--full">
              <label>Description:</label>
              <textarea matInput rows="5" class="styled-textarea" [(ngModel)]="selectedProject.description" (ngModelChange)="updateProject()" placeholder="Project description"></textarea>
            </div>
          </div>
        </div>
        <div class="project-detail-section">
          <h3>Team Members</h3>
          <div class="team-members">
            <div class="team-member" *ngFor="let member of selectedProject.team">
              <div class="member-avatar">
                <span>{{ member.name.charAt(0) }}</span>
              </div>
              <div class="member-info">
                <span class="member-name">{{ member.name }}</span>
                <span class="member-role">{{ member.role }}</span>
              </div>
              <button mat-icon-button (click)="removeTeamMember(member)">
                <mat-icon>remove_circle</mat-icon>
              </button>
            </div>
          </div>
          <div class="add-member">
            <mat-form-field appearance="outline">
              <mat-label>Add team member</mat-label>
              <mat-select [(value)]="newMemberId" (selectionChange)="addTeamMember($event)">
                <mat-option *ngFor="let user of availableUsers" [value]="user.id">
                  {{ user.name }} ({{ user.role }})
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="modal-actions" *ngIf="isCreating">
          <button mat-stroked-button (click)="closeProjectDetail()">Cancel</button>
          <button mat-raised-button color="primary" (click)="saveProject()">Save Project</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" *ngIf="showNotification">
    <mat-icon>check_circle</mat-icon>
    <span>{{ notificationMessage }}</span>
  </div>
</div>
